# Snakefile — cc̄ Background Search Study (standalone)
#
# Search for charm-anticharm resonances in M(Λ̄pK⁻) spectrum,
# separating events by B⁺ mass region (signal window vs sidebands).
#
# Usage:
#   cd analysis/studies/ccbar_background_search
#   uv run snakemake -j1
#
# Depends on Step 2 cached data from the main pipeline.

# Paths relative to this study directory → main analysis/
ANALYSIS_DIR = "../.."
CONFIG_DIR = f"{ANALYSIS_DIR}/config"
CACHE_DIR = f"{ANALYSIS_DIR}/cache"
OUTPUT_DIR = "output"

configfile: f"{ANALYSIS_DIR}/snakemake_config.yaml"

rule all:
    input:
        f"{OUTPUT_DIR}/ccbar_signal_window.pdf",
        f"{OUTPUT_DIR}/ccbar_sidebands.pdf",
        f"{OUTPUT_DIR}/ccbar_summary.csv",

rule ccbar_background_search:
    """Search for cc̄ resonances in M(Λ̄pK⁻) spectrum.

    Separates events by B⁺ mass region:
      - Signal window [5255, 5305] MeV → cc̄ from B⁺ decay
      - Sidebands (M < 5200 or M > 5350) → cc̄ NOT from B⁺ decay

    Requires Step 2 cached data from the main pipeline:
      cd analysis/ && uv run snakemake load_data -j1
    """
    input:
        # Sentinel from main pipeline Step 2
        f"{ANALYSIS_DIR}/analysis_output/.step2_complete",
    output:
        signal_plot=f"{OUTPUT_DIR}/ccbar_signal_window.pdf",
        sideband_plot=f"{OUTPUT_DIR}/ccbar_sidebands.pdf",
        csv=f"{OUTPUT_DIR}/ccbar_summary.csv",
    params:
        config_dir=CONFIG_DIR,
        cache_dir=CACHE_DIR,
        output_dir=OUTPUT_DIR,
    script:
        "study_ccbar_background_search.py"
