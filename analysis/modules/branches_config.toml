# Branch Configuration for B+ → Λ̄ p K+ K- Analysis
# This file controls which branches are loaded from ROOT files
# Supports both real data and MC (reconstructed data)

# ============================================================================
# BRANCH ALIASES - Handle differences between data and MC
# ============================================================================
[aliases]
description = """
Some branches have different names in data vs MC files.
Define aliases here to use a common name in your analysis.
Format: common_name = {data = "data_branch", mc = "mc_branch"}
"""

# PID branches - Data uses MC15TuneV1, MC uses MC12TuneV2/V3/V4
# We prefer MC15TuneV1 for data (more recent), MC12TuneV4 for MC
[aliases.pid]
# Add other particle PID if needed
Lp_ProbNNp = {data = "Lp_MC15TuneV1_ProbNNp", mc = "Lp_MC12TuneV4_ProbNNp"}
Lp_ProbNNpi = {data = "Lp_MC15TuneV1_ProbNNpi", mc = "Lp_MC12TuneV4_ProbNNpi"}
Lpi_ProbNNp = {data = "Lpi_MC15TuneV1_ProbNNp", mc = "Lpi_MC12TuneV4_ProbNNp"}
Lpi_ProbNNpi = {data = "Lpi_MC15TuneV1_ProbNNpi", mc = "Lpi_MC12TuneV4_ProbNNpi"}
h1_ProbNNk = {data = "h1_MC15TuneV1_ProbNNk", mc = "h1_MC12TuneV4_ProbNNk"}
h1_ProbNNmu = {data = "h1_MC15TuneV1_ProbNNmu", mc = "h1_MC12TuneV4_ProbNNmu"}
h1_ProbNNp = {data = "h1_MC15TuneV1_ProbNNp", mc = "h1_MC12TuneV4_ProbNNp"}
h1_ProbNNpi = {data = "h1_MC15TuneV1_ProbNNpi", mc = "h1_MC12TuneV4_ProbNNpi"}
h2_ProbNNk = {data = "h2_MC15TuneV1_ProbNNk", mc = "h2_MC12TuneV4_ProbNNk"}
h2_ProbNNmu = {data = "h2_MC15TuneV1_ProbNNmu", mc = "h2_MC12TuneV4_ProbNNmu"}
h2_ProbNNp = {data = "h2_MC15TuneV1_ProbNNp", mc = "h2_MC12TuneV4_ProbNNp"}
h2_ProbNNpi = {data = "h2_MC15TuneV1_ProbNNpi", mc = "h2_MC12TuneV4_ProbNNpi"}
p_ProbNNp = {data = "p_MC15TuneV1_ProbNNp", mc = "p_MC12TuneV4_ProbNNp"}
p_ProbNNpi = {data = "p_MC15TuneV1_ProbNNpi", mc = "p_MC12TuneV4_ProbNNpi"}

[branches]
# Define branch sets - we can enable/disable entire categories
# Default sets loaded when no explicit configuration is provided
load_sets = [
  "essential",  # Minimal branches for analysis
  "kinematics",  # Full kinematic variables
  "pid",  # Particle identification
  "selection",  # Additional branches needed for selection cuts
  "trigger"  # Trigger decision branches
]

# ============================================================================
# ADVANCED DTF BRANCHES - Decay Tree Fitter results
# ============================================================================
[branches.advanced_dtf]
Bu = [
  "Bu_DTF_M",
  "Bu_DTF_CHI2",
  "Bu_DTF_NDOF",
  "Bu_DTFL0_M",
  "Bu_DTFL0_CHI2",
  "Bu_DTFL0_NDOF",
  "Bu_DTF_Lambda0_M",
  "Bu_DTF_Lambda0_P"
]
description = "Advanced Decay Tree Fitter variables"

# ============================================================================
# ESSENTIAL BRANCHES - Always needed for basic analysis
# ============================================================================
[branches.essential]
# B+ meson
Bu = [
  "Bu_M",  # Invariant mass
  "Bu_PT",  # Transverse momentum
  "Bu_P",  # Momentum
  "Bu_ETA",  # Pseudorapidity
  "Bu_PHI",  # Azimuthal angle
  "Bu_IPCHI2_OWNPV",  # Impact parameter chi2
  "Bu_DIRA_OWNPV"  # Direction angle
]
# Λ̄ baryon
L0 = [
  "L0_M",  # Invariant mass
  "L0_PT",  # Transverse momentum
  "L0_P",  # Momentum
  "L0_ETA",  # Pseudorapidity
  "L0_PHI",  # Azimuthal angle
  "L0_IPCHI2_OWNPV",
  "L0_DIRA_OWNPV"
]
# Λ daughters (proton and pion)
Lp = ["Lp_P", "Lp_PT", "Lp_ETA", "Lp_IPCHI2_OWNPV", "Lp_ID"]
Lpi = ["Lpi_P", "Lpi_PT", "Lpi_ETA", "Lpi_IPCHI2_OWNPV", "Lpi_ID"]
description = "Minimal set of branches required for analysis"
# Event information
event = ["eventNumber", "runNumber", "nTracks"]
# Two hadrons (K+/K-)
h1 = ["h1_P", "h1_PT", "h1_ETA", "h1_IPCHI2_OWNPV", "h1_ID"]
h2 = ["h2_P", "h2_PT", "h2_ETA", "h2_IPCHI2_OWNPV", "h2_ID"]
# Bachelor proton
p = ["p_P", "p_PT", "p_ETA", "p_IPCHI2_OWNPV", "p_ID"]

# ============================================================================
# KINEMATIC BRANCHES - Extended kinematic information
# ============================================================================
[branches.kinematics]
Bu = [
  "Bu_PX",
  "Bu_PY",
  "Bu_PZ",
  "Bu_PE",
  "Bu_OWNPV_X",
  "Bu_OWNPV_Y",
  "Bu_OWNPV_Z",
  "Bu_OWNPV_CHI2",
  "Bu_OWNPV_NDOF",
  "Bu_FD_OWNPV",
  "Bu_FDCHI2_OWNPV"
]
L0 = [
  "L0_PX",
  "L0_PY",
  "L0_PZ",
  "L0_PE",
  "L0_ENDVERTEX_X",
  "L0_ENDVERTEX_Y",
  "L0_ENDVERTEX_Z",
  "L0_FD_OWNPV",
  "L0_FDCHI2_OWNPV"
]
Lp = ["Lp_PX", "Lp_PY", "Lp_PZ", "Lp_PE"]
Lpi = ["Lpi_PX", "Lpi_PY", "Lpi_PZ", "Lpi_PE"]
description = "Extended kinematic variables"
h1 = ["h1_PX", "h1_PY", "h1_PZ", "h1_PE"]
h2 = ["h2_PX", "h2_PY", "h2_PZ", "h2_PE"]
p = ["p_PX", "p_PY", "p_PZ", "p_PE"]

# ============================================================================
# MC TRUTH BRANCHES - Only available in MC files
# ============================================================================
[branches.mc_truth]
Bu = [
  "Bu_TRUEPT",
  "Bu_TRUEP_E",
  "Bu_TRUEP_X",
  "Bu_TRUEP_Y",
  "Bu_TRUEP_Z",
  "Bu_TRUEID",
  "Bu_TRUETAU",
  "Bu_TRUEORIGINVERTEX_X",
  "Bu_TRUEORIGINVERTEX_Y",
  "Bu_TRUEORIGINVERTEX_Z",
  "Bu_TRUEENDVERTEX_X",
  "Bu_TRUEENDVERTEX_Y",
  "Bu_TRUEENDVERTEX_Z"
]
L0 = [
  "L0_TRUEPT",
  "L0_TRUEP_E",
  "L0_TRUEP_X",
  "L0_TRUEP_Y",
  "L0_TRUEP_Z",
  "L0_TRUEID",
  "L0_TRUETAU"
]
Lp = ["Lp_TRUEPT", "Lp_TRUEP_E", "Lp_TRUEID"]
Lpi = ["Lpi_TRUEPT", "Lpi_TRUEP_E", "Lpi_TRUEID"]
description = "MC truth information (only in MC)"
h1 = ["h1_TRUEPT", "h1_TRUEP_E", "h1_TRUEID"]
h2 = ["h2_TRUEPT", "h2_TRUEP_E", "h2_TRUEID"]
mc_only = true  # Flag to indicate these are MC-only branches
p = ["p_TRUEPT", "p_TRUEP_E", "p_TRUEID"]

# ============================================================================
# PARTICLE IDENTIFICATION (PID) BRANCHES
# ============================================================================
[branches.pid]
# proton from L0 - using common alias names
Lp = [
  "Lp_ProbNNp",
  "Lp_ProbNNpi",
  "Lp_ProbNNk"
]
# pion from L0
Lpi = [
  "Lpi_ProbNNpi",
  "Lpi_ProbNNp",
  "Lpi_ProbNNk"
]
description = "Particle identification variables"
# hadron 1 (K+ or K-) - using common alias names
h1 = [
  "h1_ProbNNk",
  "h1_ProbNNpi",
  "h1_ProbNNp",
  "h1_ProbNNmu"
]
# hadron 2 (K+ or K-) - using common alias names
h2 = [
  "h2_ProbNNk",
  "h2_ProbNNpi",
  "h2_ProbNNp",
  "h2_ProbNNmu"
]
# bachelor proton
p = [
  "p_ProbNNp",
  "p_ProbNNpi",
  "p_ProbNNk",
  "p_ProbNNmu"
]

# ============================================================================
# SELECTION BRANCHES - Additional branches needed for selection cuts
# ============================================================================
[branches.selection]
Bu = [
  "Bu_DTF_chi2",
  "Bu_DTF_status",  # DTF quality
  "Bu_MM",  # Mass for lambda-corrected mass calculation
  "Bu_ENDVERTEX_X",
  "Bu_ENDVERTEX_Y",
  "Bu_ENDVERTEX_Z",  # Vertex position
  "Bu_ENDVERTEX_XERR",
  "Bu_ENDVERTEX_YERR",
  "Bu_ENDVERTEX_ZERR",  # Vertex errors
  "Bu_OWNPV_X",
  "Bu_OWNPV_Y",
  "Bu_OWNPV_Z"  # Primary vertex
]
L0 = [
  "L0_MM",  # Mass (different from L0_M)
  "L0_FDCHI2_OWNPV",  # Flight distance chi2
  "L0_OWNPV_X",
  "L0_OWNPV_Y",
  "L0_OWNPV_Z",  # Primary vertex
  "L0_ENDVERTEX_X",
  "L0_ENDVERTEX_Y",
  "L0_ENDVERTEX_Z",  # Decay vertex
  "L0_ENDVERTEX_XERR",
  "L0_ENDVERTEX_YERR",
  "L0_ENDVERTEX_ZERR"  # Vertex errors
]
description = "Additional branches required for selection cuts"

# ============================================================================
# TRIGGER BRANCHES
# ============================================================================
[branches.trigger]
description = "Trigger information"
trigger_lines = [
  "Bu_L0Global_TIS",
  "Bu_L0HadronDecision_TOS",
  "Bu_Hlt1TrackMVADecision_TOS",
  "Bu_Hlt1TwoTrackMVADecision_TOS",
  "Bu_Hlt2Topo2BodyDecision_TOS",
  "Bu_Hlt2Topo3BodyDecision_TOS",
  "Bu_Hlt2Topo4BodyDecision_TOS"
]

# ============================================================================
# PRESETS - Quick configuration presets
# ============================================================================
[presets]
# Full data analysis - everything
full_data = ["essential", "kinematics", "pid", "selection", "trigger", "advanced_dtf"]
# MC analysis (reconstructed) - includes MC truth branches
mc_reco = ["essential", "kinematics", "pid", "selection", "trigger", "mc_truth"]
# MC truth study - for generator-level studies
mc_truth = []  # Uses truth_branches section instead
# Minimal analysis - just enough for simple plots (no selection)
minimal = ["essential"]
# Standard analysis - for most analyses (includes selection & trigger requirements)
standard = ["essential", "kinematics", "pid", "selection", "trigger"]

# ============================================================================
# MC TRUTH TREE BRANCHES - From MCDecayTree (generator level)
# ============================================================================
[truth_branches]
Bplus = [
  "Bplus_TRUEP_E",
  "Bplus_TRUEP_X",
  "Bplus_TRUEP_Y",
  "Bplus_TRUEP_Z",
  "Bplus_TRUEPT",
  "Bplus_MC_MOTHER_ID",
  "Bplus_TRUEORIGINVERTEX_X",
  "Bplus_TRUEORIGINVERTEX_Y",
  "Bplus_TRUEORIGINVERTEX_Z",
  "Bplus_TRUEENDVERTEX_X",
  "Bplus_TRUEENDVERTEX_Y",
  "Bplus_TRUEENDVERTEX_Z"
]
Kminus = ["Kminus_TRUEPT", "Kminus_TRUEP_E", "Kminus_TRUEP_X", "Kminus_TRUEP_Y", "Kminus_TRUEP_Z"]
Kplus = ["Kplus_TRUEPT", "Kplus_TRUEP_E", "Kplus_TRUEP_X", "Kplus_TRUEP_Y", "Kplus_TRUEP_Z"]
"Lambda~0" = [
  "Lambda~0_TRUEP_E",
  "Lambda~0_TRUEP_X",
  "Lambda~0_TRUEP_Y",
  "Lambda~0_TRUEP_Z",
  "Lambda~0_TRUEPT"
]
description = "Branches from MC truth tree (MCDecayTree)"
piplus = ["piplus_TRUEPT", "piplus_TRUEP_E"]
pplus = ["pplus_TRUEPT", "pplus_TRUEP_E", "pplus_TRUEP_X", "pplus_TRUEP_Y", "pplus_TRUEP_Z"]
"p~minus" = ["p~minus_TRUEPT", "p~minus_TRUEP_E"]
