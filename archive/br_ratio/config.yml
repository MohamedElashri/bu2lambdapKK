# ------------------------------------------------------------------
# paths
# ------------------------------------------------------------------
signal_data_dir: "/share/lazy/Mohamed/Bu2LambdaPPP/RD/restripped.data/reduced"
signal_mc_dir: "/share/lazy/Mohamed/Bu2LambdaPPP/MC/DaVinciTuples/restripped.MC"
norm_data_dir: "/share/lazy/Mohamed/bu2kskpik/RD/new/final"
norm_mc_dir: "/share/lazy/Mohamed/bu2kskpik/MC/processed"
# filename substrings for discovery (data & MC can differ)
patterns:
  signal_data: "L0barPHH"
  signal_mc: "L0barPKpKm"
  norm_data: ".root"  # Match any ROOT file in the directory
  norm_mc: "B2K0s2PipPimKmPipKp"
# run period and track types
years:  ["2016", "2017", "2018"]
tracks: ["LL", "DD"]
# Normalization mode names
norm_mode_data: "KSKmKpPip"
# PDG input for normalisation channel
br_norm_pdg: 32.28e-5
br_norm_pdg_unc: 0.33
# -------------------------------------------------------------
# branch aliases
# -------------------------------------------------------------
aliases:
  mass:
    signal: "Bu_MM" 
    norm: "B_MM"   
  # tracks: (h1→K⁺, h2→K⁻, p→p⁺) vs (P0=K⁺, P2=K⁻, P1=π⁺)
  track_h1_P: ["h1_P", "P0_P"]
  track_h2_P: ["h2_P", "P2_P"]
  track_p_P: ["p_P", "P1_P"]
# -------------------------------------------------------------
# trigger alias map
# -------------------------------------------------------------
triggers:
  L0TIS:
    signal: "Bu_L0Global_TIS"
    norm: "B_L0Global_TIS"
  L0H_TOS:
    signal: "Bu_L0HadronDecision_TOS"
    norm: "B_L0HadronDecision_TOS"
  H1_TOS:
    signal: "Bu_Hlt1TrackMVADecision_TOS"
    norm: "B_Hlt1TrackMVADecision_TOS"
  H12_TOS:
    signal: "Bu_Hlt1TwoTrackMVADecision_TOS"
    norm: "B_Hlt1TwoTrackMVADecision_TOS"
  Topo2_TOS:
    signal: "Bu_Hlt2Topo2BodyDecision_TOS"
    norm: "B_Hlt2Topo2BodyDecision_TOS"
  Topo3_TOS:
    signal: "Bu_Hlt2Topo3BodyDecision_TOS"
    norm: "B_Hlt2Topo3BodyDecision_TOS"
  Topo4_TOS:
    signal: "Bu_Hlt2Topo4BodyDecision_TOS"
    norm: "B_Hlt2Topo4BodyDecision_TOS"
  HLT1TIS:
    signal: "Bu_Hlt1TrackMVADecision_TIS"
    norm: "B_Hlt1TrackMVADecision_TOS"

# -------------------------------------------------------------
# PDG Masses (for selections)
# -------------------------------------------------------------
pdg_masses:
  Lambda: 1115.683  # MeV/c^2
  K0s: 497.611      # MeV/c^2

# -------------------------------------------------------------
# Selection Variables
# -------------------------------------------------------------
# IMPORTANT: We need to verify these branch names match TTrees exactly!
selection_vars:
  # Lambda/Ks variables
  l0_endvertex_z:
    signal: "L0_ENDVERTEX_Z" 
    norm: "KS_ENDVERTEX_Z"
  l0_ownpv_z:
    signal: "L0_OWNPV_Z"     
    norm: "KS_OWNPV_Z"
  l0_fdchi2:
    signal: "L0_FDCHI2_OWNPV" 
    norm: "KS_FDCHI2_OWNPV"
  l0_m:
    signal: "L0_M"          
    norm: "KS_M"

  # PID variables (Keys MUST match usage in selections.py)
  l0_daughter1_pid: # e.g., Lambda proton / Ks pion+
    signal: "Lp_MC15TuneV1_ProbNNp" 
    norm: "P0_ProbNNp" 
  l0_daughter2_pid: # e.g., Lambda pion / Ks pion-
    signal: "Lpi_MC15TuneV1_ProbNNpi" 
    norm: "P0_ProbNNpi"

  bachelor_pid: # e.g., Signal proton / Norm pion (P1)
    signal: "p_MC15TuneV1_ProbNNp"  
    norm: "P1_ProbNNpi" 

  h1_probNNK: # e.g., Signal Kaon1 / Norm Kaon1 (P0)
    signal: "h1_MC15TuneV1_ProbNNk"  
    norm: "P0_ProbNNk"  # USER PROVIDED
  h2_probNNK: # e.g., Signal Kaon2 / Norm Kaon2 (P2)
    signal: "h2_MC15TuneV1_ProbNNk"   
    norm: "P2_ProbNNk"  # USER PROVIDED

  # Bu/B variables
  bu_pt:
    signal: "Bu_PT"              
    norm: "B_PT"
  bu_dtf_chi2:
    signal: "Bu_DTF_chi2"         
    norm: "B_ENDVERTEX_CHI2"
  bu_ipchi2:
    signal: "Bu_IPCHI2_OWNPV"     
    norm: "B_IPCHI2_OWNPV"
  bu_fdchi2:
    signal: "Bu_FDCHI2_OWNPV"
    norm: "B_FDCHI2_OWNPV"

# -------------------------------------------------------------
# Selection Cuts
# -------------------------------------------------------------
selections:
  common:
    delta_z_min: 20
    l0_fdchi2_min: 45
    kaon_pid_prod_min: 0.04
    bu_pt_min: 3000
    bu_dtf_chi2_max: 30
    bu_ipchi2_max: 10
    bu_fdchi2_min: 175
  signal: # Bu -> Lambda(p+ pi-) K+ K-
    l0_mass_window: 15  # +/- MeV around PDG Lambda mass
    proton_pid_min: 0.05 # PID cut on the proton from Lambda decay
    l0_proton_pid_min: 0.1 # Specific for Lambda's proton
  norm:   # Bu -> Ks(pi+ pi-) K+ K- (treat Ks as L0 as they are equivalent here)
    l0_mass_window: 20  # +/- MeV around PDG Ks mass
    l0_pion_pid_min: 0.1 # Specific for Ks's pion 

# Fitting parameters 
fit_params:
  mass_range:
    signal: [5200, 5400]
    norm: [5200, 5400]
  plotting:
    nbins: 50
    axis_title: "M(B^{+}) [MeV/c^{2}]"
  # PDF types available for use
  pdf_types:
    # Signal PDFs
    CrystalBall:
      parameters: ["mean", "sigma", "alpha", "n"]
    Gaussian: 
      parameters: ["mean", "sigma"]
    DoubleGaussian:
      parameters: ["mean", "sigma1", "sigma2", "frac"]
    Voigtian:
      parameters: ["mean", "width", "sigma"]
    Breit-Wigner:
      parameters: ["mean", "width"]
    # Background PDFs
    Chebychev:
      parameters: ["c1", "c2", "c3", "c4", "c5"] # Use as many as needed based on order
    Exponential:
      parameters: ["c"]
    Argus:
      parameters: ["m0", "c", "p"]
    Polynomial:
      parameters: ["c1", "c2", "c3", "c4", "c5"] # Use as many as needed based on order
    # Add more PDF types as needed
  
  # Model configurations
  models:
    signal:
      # Primary model definition
      signal_pdf: "CrystalBall"
      signal_pdf_components: []  # For composite models like double CB
      background_pdf: "Chebychev"
      background_order: 2
      # Parameter values for all potential PDFs
      parameters:
        # Signal PDF parameters
        mean: [5280, 5260, 5290]  # [initial, min, max]
        sigma: [15, 5, 30]        # [initial, min, max]
        alpha: [1.5, 0.1, 5.0]    # [initial, min, max]
        n: [2.0, 0.1, 10.0]       # [initial, min, max]
        # For DoubleGaussian if used
        sigma1: [15, 5, 30]       # [initial, min, max]
        sigma2: [20, 10, 40]      # [initial, min, max] 
        frac: [0.7, 0.1, 0.9]     # [initial, min, max]
        # For Voigtian if used
        width: [3.0, 0.1, 10.0]   # [initial, min, max]
        # Background PDF parameters
        c1: [-0.1, -1, 1]         # First Chebychev coefficient [initial, min, max]
        c2: [0.05, -1, 1]         # Second Chebychev coefficient [initial, min, max]
        # For Exponential if used
        c: [-0.005, -0.1, 0.1]    # [initial, min, max]
        # For Argus if used (rare in B physics)
        m0: [5500, 5400, 5600]    # [initial, min, max]
        p: [0.5, 0, 5]            # [initial, min, max]
    norm:
      signal_pdf: "CrystalBall"
      signal_pdf_components: []
      background_pdf: "Exponential"
      background_order: 1
      parameters:
        mean: [5280, 5260, 5290]  # [initial, min, max]
        sigma: [12, 3, 25]        # [initial, min, max]
        alpha: [1.5, 0.1, 5.0]    # [initial, min, max]
        n: [2.0, 0.1, 10.0]       # [initial, min, max]
        c: [-0.005, -0.1, 0.1]    # For Exponential (if used)
  # Fit options
  fit_options:
    use_extended: true
    print_level: 1
    use_minos: false
    use_initial_hesse: true