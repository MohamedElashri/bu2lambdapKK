# ═══════════════════════════════════════════════════════════════
# SELECTION CONFIGURATION
# ═══════════════════════════════════════════════════════════════

[lambda_selection]
# FIXED cuts (not optimized, applied to all states)
mass_min = 1111.0  # MeV/c²
mass_max = 1121.0  # MeV/c²
fd_chisq_min = 250.0
delta_z_min = 5.0  # mm (note: delta_z in mm, not significance!)
proton_probnnp_min = 0.3

[lambda_selection.notes]
comment = """
Lambda selection is FIXED (not state-dependent).
These are pre-selection cuts ensuring good Lambda reconstruction.
Applied before FOM optimization.
"""

# ═══════════════════════════════════════════════════════════════
# N-D GRID SCAN VARIABLES (7 variables only)
# ═══════════════════════════════════════════════════════════════
# Lambda cuts are FIXED and applied in Phase 2 before optimization
# Only these 7 variables are scanned in N-dimensional grid:
#   3×3×3×2×4×6×3 = 3,888 combinations per state

[nd_optimizable_selection]

[nd_optimizable_selection.bu_pt]
begin = 3000.0
end = 3500.0
step = 500.0
cut_type = "greater"
branch_name = "Bu_PT"
description = "B+ transverse momentum (MeV/c)"

[nd_optimizable_selection.bu_fdchi2]
begin = 100.0
end = 250.0
step = 50.0
cut_type = "greater"
branch_name = "Bu_FDCHI2_OWNPV"
description = "B+ flight distance chi2"

[nd_optimizable_selection.bu_ipchi2]
begin = 0.0
end = 10.0
step = 2.0
cut_type = "less"
branch_name = "Bu_IPCHI2_OWNPV"
description = "B+ impact parameter chi2"

[nd_optimizable_selection.bu_dtf_chi2]
begin = 10.0
end = 30.0
step = 10.0
cut_type = "less"
branch_name = "Bu_DTF_chi2"
description = "B+ decay tree fit chi2"

[nd_optimizable_selection.h1_probnnk]
begin = 0.1
end = 0.3
step = 0.1
cut_type = "greater"
branch_name = "h1_ProbNNk"
description = "K+ PID probability"

[nd_optimizable_selection.h2_probnnk]
begin = 0.1
end = 0.3
step = 0.1
cut_type = "greater"
branch_name = "h2_ProbNNk"
description = "K- PID probability"

[nd_optimizable_selection.p_probnnp]
begin = 0.1
end = 0.3
step = 0.1
cut_type = "greater"
branch_name = "p_ProbNNp"
description = "Bachelor proton PID probability"

# ═══════════════════════════════════════════════════════════════
# OLD 1D SCAN VARIABLES (not used when method="nd_grid_scan")
# ═══════════════════════════════════════════════════════════════

[bu_fixed_selection]
# FIXED cuts (not optimized)
mass_corrected_min = 5255.0  # MeV/c² (B+ mass ± 25 MeV)
mass_corrected_max = 5305.0  # MeV/c²

[bu_fixed_selection.notes]
comment = """
B+ mass cut using Lambda-corrected mass.
This accounts for Lambda mass constraint effects.
FIXED window, not optimized.
"""

[bu_optimizable_selection]
# Variables to optimize with FOM scan
# Format: {variable_name}.{begin/end/step}

[bu_optimizable_selection.pt]
begin = 2000.0   # MeV/c
end = 10000.0
step = 500.0
cut_type = "greater"
description = "B+ transverse momentum"

[bu_optimizable_selection.dtf_chi2]
begin = 0.0
end = 50.0
step = 2.0
cut_type = "less"
description = "B+ decay tree fit χ²"

[bu_optimizable_selection.ipchi2]
begin = 0.0
end = 25.0
step = 1.0
cut_type = "less"
description = "B+ impact parameter χ² to PV (should be small - B from PV)"

[bu_optimizable_selection.fdchi2]
begin = 0.0
end = 500.0
step = 20.0
cut_type = "greater"
description = "B+ flight distance χ² from PV (should be large - B flies)"

[bachelor_p_optimizable_selection]
# Bachelor antiproton cuts to optimize

[bachelor_p_optimizable_selection.probnnp]
begin = 0.0
end = 0.5
step = 0.05
cut_type = "greater"
description = "Bachelor p̄ PID probability"

[bachelor_p_optimizable_selection.track_chi2ndof]
begin = 0.0
end = 5.0
step = 0.25
cut_type = "less"
description = "Bachelor p̄ track quality"

[bachelor_p_optimizable_selection.ipchi2]
begin = 0.0
end = 100.0
step = 5.0
cut_type = "greater"
description = "Bachelor p̄ IP χ² to PV (should be large - not from PV)"

[kplus_optimizable_selection]
# K+ cuts to optimize

[kplus_optimizable_selection.probnnk]
begin = 0.0
end = 0.5
step = 0.05
cut_type = "greater"
description = "K+ PID probability"

[kplus_optimizable_selection.track_chi2ndof]
begin = 0.0
end = 5.0
step = 0.25
cut_type = "less"
description = "K+ track quality"

[kplus_optimizable_selection.ipchi2]
begin = 0.0
end = 100.0
step = 5.0
cut_type = "greater"
description = "K+ IP χ² to PV"

[kminus_optimizable_selection]
# K- cuts to optimize (same structure as K+)

[kminus_optimizable_selection.probnnk]
begin = 0.0
end = 0.5
step = 0.05
cut_type = "greater"
description = "K- PID probability"

[kminus_optimizable_selection.track_chi2ndof]
begin = 0.0
end = 5.0
step = 0.25
cut_type = "less"
description = "K- track quality"

[kminus_optimizable_selection.ipchi2]
begin = 0.0
end = 100.0
step = 5.0
cut_type = "greater"
description = "K- IP χ² to PV"

[optimization_strategy]
method = "nd_grid_scan"
comment = """
N-D grid scan: Exhaustive search over all combinations of cut values

Only these 7 variables are optimized (Lambda cuts already fixed in Phase 2):
- h1_ProbNNk (K+): > [0.1, 0.3, 0.1] → 3 points
- h2_ProbNNk (K-): > [0.1, 0.3, 0.1] → 3 points
- p_ProbNNp (bachelor proton): > [0.1, 0.3, 0.1] → 3 points
- Bu_PT: > [3000, 3500, 500] → 2 points
- Bu_FDCHI2: > [100, 250, 50] → 4 points
- Bu_IPCHI2: < [0, 10, 2] → 6 points
- Bu_DTF_chi2: < [10, 30, 10] → 3 points

Total: 3×3×3×2×4×6×3 = 3,888 combinations per state (very fast!)

For each state (J/ψ, ηc, χc0, χc1):
- Test ALL combinations in 7D grid
- Find combination that maximizes FOM
- Output optimal cuts for each state
"""

[optimization_strategy.notes]
important = """
⚠️ Different states may need different cuts!
   - ηc: Lowest mass, softer particles → may need softer cuts
   - J/ψ: Highest statistics → can use tighter cuts
   - χc states: Medium requirements

The optimization is STATE-DEPENDENT, producing separate
cut values for each charmonium state.

However, for simplicity in first iteration, we can optimize
for χc states (limiting precision) and use same for all.
"""